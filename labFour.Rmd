---
title: Lab 4
author: Thomas and Saleh
output: pdf_document
---

```{r library}
library(leaps)
library(ggplot2)
library(glmnet)
library(pspline)
```


```{r betty_setup}
n <- 100
sig <- 1
b <- c(1.5, -2,-0.5, 1)
set.seed(10)
x <- sort(round(runif(n, -2, 2), 2))
eps <- rnorm(n, 0, sig)
ones <- vector(length = n) + 1
x2 <- x^2
x3 <- x^3
xmat <- cbind(ones, x, x2, x3)
fx <- xmat %*% b
y <- fx + eps
data <- data.frame(x, y)
plot(x, fx, type = 'l', lwd = 2, ylim = c(-5, 5),
     main = 'True relationship between y and x with generated sample')
points(x, y, pch=19)
```


## One

$$
y = 1.5 - 2 x - 0.5 x^2 + x^3 + \epsilon
$$

## Two

```{r two_set}
data[, 3] <- data[, 1]^2
data[, 4] <- data[, 1]^3
data[, 5] <- data[, 1]^4
data[, 6] <- data[, 1]^5
data[, 7] <- data[, 1]^6
data[, 8] <- data[, 1]^7
data[, 9] <- data[, 1]^8
data[, 10] <- data[, 1]^9
data[, 11] <- data[, 1]^10

sub <- leaps::regsubsets(as.matrix(data[, -2]), as.matrix(data[,2]))
our_sum <- summary(sub)

fourth <- coef(sub, 4)
third <- coef(sub, 3)
```

### a

According to Cp criterion the 4th model is the best with a cp of **`r round(our_sum$cp[4], 2)`**
this model is...
$$
y = `r round(fourth[1], digits = 2)` + `r round(fourth[2], digits = 2)` x + `r round(fourth[3], digits = 2)` x^2 + `r round(fourth[4], digits = 2)` x^3 + `r round(fourth[5], digits = 2)` x^4
$$

### b

According to the BIC the third model is the best with a BIC of **`r round(our_sum$bic[3], 2)`**
this model is...
$$
y = `r round(third[1], digits = 2)` + `r round(third[2], digits = 2)` x + `r round(third[3], digits = 2)` x^2 + `r round(third[4], digits = 2)` x^3
$$

### c

According to adjusted r^2 the fourth model is the best with a adjr^2 of **`r round(our_sum$adjr2[4], 2)`**
this model is...
$$
y = `r round(fourth[1], digits = 2)` + `r round(fourth[2], digits = 2)` x + `r round(fourth[3], digits = 2)` x^2 + `r round(fourth[4], digits = 2)` x^3 + `r round(fourth[5], digits = 2)` x^4
$$

### d
```{r plots with full}
x4 <- x^4
xmat2 <- cbind(ones, x, x2, x3, x4)
f4 <- xmat2 %*% fourth
f3 <- xmat %*% third


ggplot() + geom_line(aes(x, f3), colour = "red") + geom_line(aes(x, f4), colour = "orange") + geom_line(aes(x, fx)) +
  geom_point(aes(x, y))  + geom_line(aes(x, fk), colour = "green") + theme_bw()
```

In short my ggplot looks far superior to your base r plot...

## 3

```{r three_set}
frw_sub <- leaps::regsubsets(as.matrix(data[, -2]), as.matrix(data[,2]), method = "forward")
bwd_sub <- leaps::regsubsets(as.matrix(data[, -2]), as.matrix(data[,2]), method = "backward")

frw_sum <- summary(frw_sub)
bwd_sum <- summary(bwd_sub)
```

### a

cp forward the fifth model is the best `r frw_sum$cp[5]`

cp backward the fifth model is best here too `r bwd_sum$cp[5]`


### b

bic forward the fourth model is best here `r frw_sum$bic[4]`

bic backward the fourth model is best here too `r bwd_sum$bic[4]`


### c 

adjr^2 forward the fifth model is best here with `r frw_sum$adjr2[5]`

adjr^2 backward the fifth model is also best here with `r bwd_sum$adjr2[5]`


## 4

```{r four}
my_glm <- glmnet(as.matrix(data[,-2]), data[, 2], alpha = 1, lambda = 0.5)
cv_base <- cv.glmnet(as.matrix(data[,-2]), data[, 2], alpha = 1)
cv_base$lambda.min

lassmod <- predict(my_glm, s=cv_base$lambda.min, type="coefficients" )

coefs <- c(1.185542486, -0.174601519, 0.001026240, 0.005451162)

x7 <- x^7
x9 <- x^9
xmat3 <- cbind(ones, x2, x7, x9)

fk <- xmat3 %*% coefs

```


## 5

```{r five}
sm.spline(x, y) # w/df of 2, 3, 4, 5, 15
```

## 6

Which fit provided the best fit, and give support to your response.
